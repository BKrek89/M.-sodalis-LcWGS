#in safnok folder
for POP in AR_A MO_A NJ_A NY_A AR_B MO_B NJ_B NY_B; do echo $POP; /local/opt/angsd/misc/realSFS -P 25 "$POP"_75m_fst.saf.idx > /local/home/robertk/sodalis/sodalisa1/thetanok/75m/"$POP"_75m.fort.ml; done

#in thetanok folder
for POP in AR_A MO_A NJ_A NY_A AR_B MO_B NJ_B NY_B; do echo $POP; /local/opt/angsd/misc/realSFS saf2theta /local/home/robertk/sodalis/sodalisa1/safnok/75m/"$POP"_75m_fst.saf.idx 
-sfs  "$POP"_75m.fort.ml -outname "$POP"_75m.theta.out; done


Calculate tajima's d for each scaffold and sliding window
#50000 and 10000
for POP in AR_A MO_A NJ_A NY_A AR_B MO_B NJ_B NY_B; do echo $POP; /local/opt/angsd/misc/thetaStat do_stat "$POP"_75m.theta.out.thetas.idx -nChr 10333 -outnames "$POP"_75m.theta.out.thetas.idx2; done

for POP in AR_A MO_A NJ_A NY_A AR_B MO_B NJ_B NY_B; do echo $POP; /local/opt/angsd/misc/thetaStat do_stat "$POP"_75m.theta.out.thetas.idx -nChr 10333 -win 50000 -step 10000 -type 1 -outnames "$POP"_75m.thetas_50sw ; done

for POP in AR_A AR_B MO_A MO_B NJ_A NJ_B NY_A NY_B; do echo $POP; 
awk '{print $2" "$3" "$5" "$9" "$14}' "$POP"_75m.thetas_50sw.pestPG | sed -e 's/(/ /g' -e 's/)//g' > "$POP"_75m.thetas_50sw 
done

#10,000 and 2000
for POP in AR_A MO_A NJ_A NY_A AR_B MO_B NJ_B NY_B; do echo $POP; /local/opt/angsd/misc/thetaStat do_stat "$POP"_75m.theta.out.thetas.idx -nChr 10333 -win 10000 -step 2000 -type 1 -outnames "$POP"_75m.thetas_10sw ; done

for POP in AR_A AR_B MO_A MO_B NJ_A NJ_B NY_A NY_B; do echo $POP; 
awk '{print $2" "$3" "$5" "$9}' "$POP"_75m.thetas_10sw.pestPG | sed -e 's/(/ /g' -e 's/)//g' > "$POP"_75m.thetas_10sw 
done

#look for windows with Tajimas D higher than 2 or lower than -2
for POP in AR_A AR_B MO_A MO_B NJ_A NJ_B NY_A NY_B; do
    echo $POP
    awk '(NR==1) || ($4 > 2)' "${POP}_25m.thetas_10sw" > "tajdsel/${POP}.25m.10.td.up"
done

for POP in AR_A AR_B MO_A MO_B NJ_A NJ_B NY_A NY_B; do
    echo $POP
    awk '(NR==1) || ($4 < -2)' "${POP}_25m.thetas_10sw" > "tajdsel/${POP}.25m.10.td.do"
done


##find outlier tajd windows that exist in post-WNS but not pre
for POP in AR MO NJ NY; do
    echo $POP
awk 'NR==FNR { bad[$1 FS $2]; next } !($1 FS $2 in bad)' "$POP"_B.75m.10.td.up "$POP"_A.75m.10.td.up > "$POP".75m.10.td.up.txt
done

##remove windows with < 10 loci
for POP in AR.25m AR.75m MO.25m MO.75m NJ.25m NJ.75m NY.25m NY.75m; do
    echo $POP
awk '($5 > 10) ' "$POP".10.td.up.txt > "$POP".10.td.up.n.txt
done

##combine missingness groups to find regions only in both
awk 'FNR==NR{arr[$1,$2];next}(($1,$2) in arr)' AR.25m.10.td.up.n.txt AR.75m.10.td.up.n.txt > AR.10.td.up.n.txt

##look for matching windows between states both within each quality iterations and among all
awk 'FNR==NR{arr[$1,$2];next}(($1,$2) in arr)' AR.10.td.up.n.txt NY.10.td.up.n.txt > ARNY.10.td.up.n.txt
